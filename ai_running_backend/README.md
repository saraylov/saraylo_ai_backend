# Система оценки физиологического состояния во время пробежек

## Описание проекта

Система оценки физиологического состояния во время пробежек - это серверная система на основе нейронной сети, предназначенная для оценки физиологического состояния пользователей в реальном времени во время тренировок. Система предоставляет RESTful API для клиентских приложений (iOS/Android) для отправки необработанных данных о тренировке и получения структурированной аналитики и рекомендаций.

## Основные функции

1. **Оценка физиологического состояния в реальном времени** во время тренировок
2. **Персонализированные рекомендации по тренировке** на основе биометрических данных
3. **Интеллектуальный мониторинг состояния усталости и восстановления**
4. **Анализ эффективности тренировки**
5. **Динамическая постановка целей** через установочную тренировку
6. **Аудио-взаимодействие** для уточнения целей и мотивации
7. **Интеллектуальная классификация целей** с адаптацией тренировочного плана
8. **Персонализированные рекомендации по питанию**
9. **Обработка данных в соответствии с GDPR/HIPAA**
10. **Комплексная система ведения журнала ошибок**

## Технологический стек

- **Python 3.8+**
- **PyTorch** для реализации нейронной сети
- **Flask** для RESTful API
- **Redis** для кэширования сессий
- **RabbitMQ** для потоковой обработки
- **Docker** для контейнеризации
- **Prometheus + Grafana** для мониторинга
- **ELK Stack** для логирования

## Установка и запуск

### Локальная установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd ai_running_backend
```

2. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # В Windows: venv\Scripts\activate
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Запустите Redis и RabbitMQ (если не используете Docker):
```bash
# Redis
redis-server

# RabbitMQ
# Следуйте инструкциям по установке RabbitMQ для вашей ОС
```

5. Запустите приложение:
```bash
python api/workout_api.py
```

### Запуск с помощью Docker

1. Соберите и запустите сервисы:
```bash
docker-compose up -d
```

2. Доступ к API по адресу `http://localhost:5000`

3. Доступ к интерфейсу управления RabbitMQ: `http://localhost:15672`
   - Логин: appuser
   - Пароль: apppass

4. Доступ к Grafana: `http://localhost:3000`
   - Логин: admin
   - Пароль: admin

5. Доступ к Kibana: `http://localhost:5601`

## Авторизация через Telegram

Для использования авторизации через Telegram необходимо:

1. Создать Telegram бота через [@BotFather](https://t.me/BotFather)
2. Получить Telegram Bot Token
3. Настроить домен приложения в настройках бота
4. Использовать виджет авторизации Telegram в веб-приложении

### Настройка Telegram бота

1. Откройте [@BotFather](https://t.me/BotFather) в Telegram
2. Создайте нового бота с помощью команды `/newbot`
3. Следуйте инструкциям для получения Bot Token
4. Установите домен для авторизации с помощью команды `/setdomain`
5. Введите домен вашего приложения: `https://07964add0b7e.ngrok-free.app/`

### Использование в веб-приложении

В веб-приложении используется виджет авторизации Telegram:

```html
<script async src="https://telegram.org/js/telegram-widget.js?22" 
        data-telegram-login="Saraylov_bot" 
        data-size="large" 
        data-radius="20" 
        data-auth-url="https://07964add0b7e.ngrok-free.app/auth/telegram"
        data-request-access="write">
</script>
```

## Тестирование

Для запуска всех тестов выполните:

```bash
python run_tests.py
```

## Структура проекта

- `api/` - RESTful API на Flask
- `models/` - Модели нейронной сети на PyTorch
- `data_processing/` - Модуль обработки данных и извлечения признаков
- `sessions/` - Управление сессиями тренировок
- `nutrition/` - Модуль питания и рекомендаций
- `tests/` - Модульные тесты
- `docker/` - Конфигурации Docker
- `prometheus/` - Конфигурации Prometheus
- `logstash/` - Конфигурации Logstash

## API

Основные конечные точки API:

- `POST /v1/auth/login` - Аутентификация по API ключу
- `POST /auth/telegram` - Авторизация через Telegram
- `POST /v1/workout/start` - Начало сессии тренировки
- `POST /v1/workout/update` - Обновление данных тренировки
- `POST /v1/workout/end` - Завершение сессии тренировки
- `POST /v1/nutrition/preferences` - Установка предпочтений питания
- `POST /v1/nutrition/plan` - Генерация плана питания