# Архитектура системы

## Общая архитектура

Система использует гибридную архитектуру нейронной сети, сочетающую:

1. **Модуль обработки временных рядов**: LSTM/Transformer для данных временных рядов (ЧСС, скорость)
2. **Модуль обработки статических характеристик**: MLP для данных профиля пользователя
3. **Модуль слияния**: Объединяет временные и статические характеристики с механизмом внимания
4. **Выходной модуль**: Генерирует оценку состояния и рекомендации

## Компоненты системы

### 1. Модель нейронной сети

Гибридная архитектура нейронной сети на основе PyTorch, сочетающая:
- **Временной трансформер слияния (TFT)** для обработки данных временных рядов (ЧСС, скорость)
- **MLP** для статических данных профиля пользователя и калибровки
- **Механизм внимания** для выявления критических паттернов

Ключевые особенности:
- Многоголовый вывод для различных физиологических метрик
- Слои LSTM для временной обработки
- Внимание трансформера для распознавания паттернов
- Отдельные пути обработки для временных и статических признаков

### 2. Обработка данных

Обрабатывает извлечение признаков и предварительную обработку:
- Извлечение временных признаков из потока данных тренировки
- Извлечение статических признаков из профиля пользователя и калибровки
- Нормализация признаков для входа в нейронную сеть
- Расчет метрик HRV и скорости

### 3. Управление сессиями

Управляет сессиями тренировок и ограничением скорости:
- Создание, обновление и завершение сессий тренировок
- Хранение сессий на основе Redis с истечением срока
- Ограничение скорости (6 запросов/минуту на сессию)
- Управление потоком данных для каждой сессии

### 4. RESTful API

Предоставляет конечные точки REST для клиентских приложений:
- **POST /v1/workout/start** - Инициализация сессии тренировки
- **POST /v1/workout/update** - Обновление новыми данными тренировки
- **POST /v1/workout/end** - Завершение сессии тренировки
- **POST /v1/auth/login** - Конечная точка аутентификации

Особенности:
- Аутентификация на основе токенов JWT
- Принудительное ограничение скорости
- Анализ физиологического состояния
- Генерация рекомендаций

### 5. Модуль питания

Обеспечивает персонализированные рекомендации по питанию:
- Анализ потребностей в питательных веществах
- Генерация индивидуального плана питания
- Учет целей пользователя и физиологического состояния
- Интеграция с основной моделью физиологического состояния

### 6. Конфигурация

Управление конфигурацией:
- Конфигурация на основе среды (разработка, тестирование, производство)
- Настройки Redis и базы данных
- Ограничения скорости API и тайм-ауты
- Настройки безопасности и ведения журнала

### 7. Развертывание

Контейнеризованное развертывание с:
- Сервисом Flask API
- Redis для кэширования сессий
- RabbitMQ для очереди сообщений
- Prometheus и Grafana для мониторинга
- Стек ELK для логирования

### 8. Тестирование

Модульные тесты для основной функциональности:
- Управление сессиями тренировок
- Хранение и извлечение сессий
- Ограничение скорости
- Обработка потока данных